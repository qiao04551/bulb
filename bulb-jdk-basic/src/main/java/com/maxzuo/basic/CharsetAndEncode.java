package com.maxzuo.basic;

import org.junit.Test;

import java.io.UnsupportedEncodingException;
import java.nio.ByteBuffer;
import java.nio.ByteOrder;
import java.nio.CharBuffer;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.Properties;

/**
 * Javaå­—ç¬¦çš„ç¼–ç å’Œè§£ç 
 * <p>
 * Created by zfh on 2020/01/12
 */
public class CharsetAndEncode {

    /**
     * 1.ç¼–ç å­—ç¬¦é›†
     *   Javaä½¿ç”¨çš„unicodeï¼Œç”±äºç¼–ç å­—ç¬¦é›†ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦èµ‹äºˆä¸€ä¸ªæ•°å­—ï¼Œå› æ­¤åœ¨javaå†…éƒ¨ï¼Œå­—ç¬¦å¯ä»¥è®¤ä¸ºå°±æ˜¯ä¸€ä¸ª16ä½çš„æ•°å­—ï¼Œ
     *   å› æ­¤ä»¥ä¸‹æ–¹å¼éƒ½å¯ä»¥ç»™å­—ç¬¦èµ‹å€¼ï¼š
     */
    @Test
    public void testCharset () {
        char a = 'ä¸­';
        char b = 0x4e2d;
        char c = 20013;
        System.out.println(a);
        System.out.println(b);
        System.out.println(c);
    }

    /**
     * 2.å­—ç¬¦ç¼–ç æ–¹æ¡ˆï¼ˆCharacter-encoding schemaï¼‰
     *   å°†å­—ç¬¦ç¼–ç ï¼ˆæ•°å­—ï¼‰æ˜ å°„åˆ°ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„æ–¹æ¡ˆï¼Œå› ä¸ºåœ¨ç£ç›˜é‡Œï¼Œæ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯ä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨çš„ã€‚å› æ­¤Javaçš„16ä½å­—ç¬¦
     *   å¿…é¡»è½¬æ¢ä¸ºä¸€ä¸ªå­—èŠ‚æ•°ç»„æ‰èƒ½å¤Ÿå­˜å‚¨ã€‚ä¾‹å¦‚UTF-8å­—ç¬¦ç¼–ç æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸º1ã€2ã€3æˆ–è€…4ä¸ªå­—èŠ‚ã€‚ä¸€èˆ¬è®¤ä¸ºï¼Œ
     *   ç¼–ç å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç æ–¹æ¡ˆåˆèµ·æ¥è¢«ç§°ä¹‹ä¸ºå­—ç¬¦é›†ï¼ˆCharsetï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œè¦å’Œå‰é¢çš„å­—ç¬¦é›†åˆï¼ˆCharacter setï¼‰
     *   åŒºåˆ†å¼€ã€‚
     */
    @Test
    public void testCharacterEncodeSchema () {
        String str = "hello world";
        // ä»æ•°å­—åˆ°å­—èŠ‚æ•°ç»„ï¼Œè¿™ä¸ªè½¬æ¢è¢«ç§°ä¹‹ä¸ºç¼–ç 
        byte[] tmpBytes = str.getBytes(StandardCharsets.UTF_8);
        System.out.println(Arrays.toString(tmpBytes));

        // ç¼–ç æ–¹å¼äºŒ
        ByteBuffer byteBuffer = StandardCharsets.UTF_8.encode(str);
        byte[] tmpBytes2 = new byte[byteBuffer.remaining()];
        byteBuffer.get(tmpBytes2);
        System.out.println(Arrays.toString(tmpBytes2));

        // è§£ç çš„ä¸¤ç§æ–¹å¼
        System.out.println(new String(tmpBytes, StandardCharsets.UTF_8));

        ByteBuffer buffer = ByteBuffer.wrap(tmpBytes);
        CharBuffer charBuffer = StandardCharsets.UTF_8.decode(buffer);
        System.out.println(charBuffer.toString());
    }

    /**
     * 3.é»˜è®¤çš„å­—ç¬¦é›†
     *   Javaçš„é»˜è®¤å­—ç¬¦é›†ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªåœ°æ–¹è®¾å®šï¼Œä¸€æ˜¯æ‰§è¡Œjavaç¨‹åºæ—¶ä½¿ç”¨-Dfile.encodingå‚æ•°æŒ‡å®šï¼Œä¾‹å¦‚-Dfile.encoding=UTF-8
     *   å°±æŒ‡å®šé»˜è®¤å­—ç¬¦é›†æ˜¯UTF-8ã€‚äºŒæ˜¯åœ¨ç¨‹åºæ‰§è¡Œæ—¶ä½¿ç”¨Propertiesè¿›è¡ŒæŒ‡å®šï¼Œå¦‚ä¸‹ï¼š
     *   æ³¨æ„ï¼šè¿™ä¸¤ç§æ–¹æ³•å¦‚æœåŒæ—¶ä½¿ç”¨ï¼Œåˆ™ç¨‹åºå¼€å§‹æ—¶ä½¿ç”¨å‚æ•°æŒ‡å®šçš„å­—ç¬¦é›†ï¼Œåœ¨Propertiesæ–¹æ³•åä½¿ç”¨PropertiesæŒ‡å®šçš„å­—ç¬¦é›†ã€‚
     *   å¦‚æœè¿™ä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰ä½¿ç”¨ï¼Œåˆ™ä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦é›†ã€‚
     */
    @Test
    public void testDefaultCharset() {
        Properties properties = System.getProperties();
        properties.put("file.encoding", "UTF-8");
        System.out.println(properties.get("file.encoding"));
    }

    /**
     * 4.å¤§å°ç«¯å­—èŠ‚åº
     *   å­—èŠ‚åºå°±æ˜¯æ•°æ®åœ¨å†…å­˜ä¸­å­˜æ”¾çš„é¡ºåºï¼Œå¤šäºä¸€ä¸ªå­—èŠ‚çš„æ•°æ®åœ¨å†…å­˜ä¸­å­˜æ”¾æ—¶æœ‰ä¸¤ç§é€‰æ‹©ï¼Œå³Big Endianå’ŒLittle Endianã€‚
     *   Little-Endianå°±æ˜¯ä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œé«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚
     *   Big-Endianå°±æ˜¯é«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚
     *   Big Endianå’ŒLittle Endianå’ŒèŠ¯ç‰‡ç±»å‹ä»¥åŠæ“ä½œç³»ç»Ÿéƒ½æœ‰å…³ç³»ã€‚ä½†æ˜¯ç”±äºJavaæ˜¯å¹³å°æ— å…³çš„ï¼Œæ‰€ä»¥Javaè¢«è®¾è®¡ä¸ºBig Endiançš„ã€‚
     *   ä½†æ˜¯å½“Javaä¸­çš„å­—ç¬¦è¿›è¡Œç¼–ç æ—¶ï¼Œå°±è¦æ³¨æ„å…¶å­—èŠ‚åºäº†ã€‚
     *
     * <pre>
     *   å†…å­˜åœ°å€
     *       å†…å­˜åœ°å€åªæ˜¯ä¸€ä¸ªç¼–å·ï¼Œä»£è¡¨ä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚é‚£ä¹ˆè¿™ä¸ªç©ºé—´æ˜¯å¤šå¤§å‘¢ï¼ŸåŸæ¥åœ¨è®¡ç®—æœºä¸­å­˜å‚¨å™¨çš„å®¹é‡æ˜¯ä»¥å­—èŠ‚ä¸ºåŸºæœ¬å•ä½çš„ã€‚
     *       ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå†…å­˜åœ°å€ä»£è¡¨ä¸€ä¸ªå­—èŠ‚ï¼ˆ8bitï¼‰çš„å­˜å‚¨ç©ºé—´ã€‚
     *
     *       å†…å­˜æ˜¯æŠŠ8ä¸ªbitæ’æˆ1ç»„ï¼Œæ¯1ç»„æˆä¸º1ä¸ªå•ä½ï¼Œå¤§å°æ˜¯1byte(å­—èŠ‚ï¼‰ï¼ŒCPUæ¯ä¸€æ¬¡åªèƒ½è®¿é—®1ä¸ªbyteï¼Œè€Œä¸èƒ½å•ç‹¬å»è®¿é—®å…·ä½“çš„1ä¸ªbitã€‚
     *       1ä¸ªbyteï¼ˆå­—èŠ‚ï¼‰å°±æ˜¯å†…å­˜çš„æœ€å°çš„IOå•ä½ã€‚
     *
     *       32ä½ç³»ç»Ÿé‡Œå†…å­˜åœ°å€é•¿åº¦æ˜¯32ä½ï¼Œæ‰€ä»¥32ä½çš„åœ°å€èŒƒå›´å°±æ˜¯ä» 0000 0000 0000 0000 0000 0000 0000 0000 åˆ° 1111 1111 1111
     *       1111 1111 1111 1111 1111ï¼ˆOx00000000 ~ OxFFFFFFFF)ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¯»å€2^32ä¸ªåœ°å€ï¼Œæ¯ä¸ªåœ°å€å¯¹åº”ä¸€ä¸ª8bitçš„çš„å†…å­˜å•ä½ã€‚
     *
     *       ä¾‹å¦‚ç»å¸¸è¯´32ä½çš„æ“ä½œç³»ç»Ÿæœ€å¤šæ”¯æŒ4GBçš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´CPUåªèƒ½å¯»å€2çš„32æ¬¡æ–¹ï¼ˆ4GBï¼‰ï¼Œæ³¨æ„è¿™é‡Œçš„4GBæ˜¯ä»¥Byteä¸ºå•ä½çš„ï¼Œä¸æ˜¯
     *       bitã€‚ä¹Ÿå°±æ˜¯è¯´æœ‰4G = 4*1024Mï¼ˆByteï¼‰= 4*1024*1024Kb(Byte) = 4*1024*1024*1024Byte(8bit)ï¼Œå³2çš„32æ¬¡æ–¹ä¸ª8bitå•ä½ã€‚
     *
     *       æ€»ç»“ï¼šå†…å­˜åœ°å€æ˜¯å†…å­˜å½“ä¸­å­˜å‚¨æ•°æ®çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œé€šè¿‡å†…å­˜åœ°å€å¯ä»¥æ‰¾åˆ°å†…å­˜å½“ä¸­å­˜å‚¨çš„æ•°æ®ã€‚
     *
     *
     *  é«˜ä½/ä½ä½å­—èŠ‚
     *       ä¸€èˆ¬ä¸€ä¸ª16ä½ï¼ˆåŒå­—èŠ‚ï¼‰çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š0xFF1Aï¼ˆ16è¿›åˆ¶ï¼‰ï¼Œé‚£ä¹ˆé«˜ä½å­—èŠ‚å°±æ˜¯FFï¼Œä½ä½æ˜¯1A
     *       å¦‚æœæ˜¯32ä½çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š0x3F68415Bï¼Œé«˜ä½å­—ï¼ˆä¸æ˜¯å­—èŠ‚ï¼‰æ˜¯3F68ï¼Œä½ä½å­—æ˜¯415Bã€‚
     *
     *       ä¾‹å¦‚å®šä¹‰ä¸€ä¸ªunsigned shortå‹å˜é‡åœ¨0x1234 5678ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡çš„åœ°å€å°±æ˜¯0x1234 5678ï¼Œå ç”¨0x1234 5678ä¸0x1234 5679ä¸¤å­—èŠ‚
     *       å­˜å‚¨ç©ºé—´ï¼Œå…¶ä¸­0x1234 5678æ˜¯ä½å­—èŠ‚ã€0x1234 5679æ˜¯é«˜å­—èŠ‚ã€‚
     *
     * 	å­—èŠ‚åº
     * 	     ä¸€ä¸ªå­—èŠ‚ä¸­è¿˜åŒ…å«8ä¸ªbit (bit = binary digit)ï¼Œåœ¨ä¸€ä¸ª32ä½çš„CPUä¸­â€œå­—é•¿â€ä¸º32ä¸ªbitï¼Œä¹Ÿå°±æ˜¯4ä¸ªbyteã€‚åœ¨è¿™æ ·çš„CPUä¸­ï¼Œæ€»æ˜¯ä»¥
     *       4å­—èŠ‚å¯¹é½çš„æ–¹å¼æ¥è¯»å–æˆ–å†™å…¥å†…å­˜ï¼Œé‚£ä¹ˆåŒæ ·è¿™4ä¸ªå­—èŠ‚çš„æ•°æ®æ˜¯ä»¥ä»€ä¹ˆé¡ºåºä¿å­˜åœ¨å†…å­˜ä¸­çš„å‘¢ï¼Ÿ
     *
     *       å­—èŠ‚åºåŒ…æ‹¬ï¼šå¤§ç«¯åºå’Œå°ç«¯åºï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆéº»çƒ¦è¿˜è¦åˆ†é—¨åˆ«ç±»å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œ255ç”¨äºŒè¿›åˆ¶è¡¨è¾¾å°±æ˜¯1111 1111ï¼Œå†åŠ 1å°±æ˜¯1 0000 0000ï¼Œ
     *       å¤šäº†ä¸€ä¸ª1å‡ºæ¥ï¼Œæ˜¾ç„¶æˆ‘ä»¬éœ€è¦å†ç”¨é¢å¤–çš„ä¸€ä¸ªå­—èŠ‚æ¥å­˜æ”¾è¿™ä¸ª1ï¼Œä½†æ˜¯è¿™ä¸ª1è¦å­˜æ”¾åœ¨ç¬¬ä¸€ä¸ªå­—èŠ‚è¿˜æ˜¯ç¬¬äºŒä¸ªå­—èŠ‚å‘¢ï¼Ÿè¿™æ—¶å€™å› ä¸ºäººä»¬é€‰æ‹©çš„
     *       ä¸åŒï¼Œå°±å‡ºç°äº†å¤§ç«¯åºå’Œå°ç«¯åºçš„å·®å¼‚ã€‚
     *
     *       å¤§ç«¯åºçš„é«˜å­—èŠ‚å­˜åœ¨ä½åœ°å€ï¼Œä½å­—èŠ‚å­˜åœ¨é«˜åœ°å€ï¼Œå°ç«¯åºç›¸åï¼Œç½‘ç»œåºä¸€èˆ¬ä¸ºå¤§ç«¯åºã€‚
     *
     *       åœ¨è¯»å†…å­˜æ—¶ä¸€èˆ¬ä»ä½å­—èŠ‚å‘é«˜å­—èŠ‚è¯»å–ã€‚
     *
     *       å¦‚ä¸€ä¸ªlongå‹æ•°æ®0x12345678
     *       å¤§ç«¯å­—èŠ‚åºï¼š
     * 	     å†…å­˜ä½åœ°å€--> 0x12
     *                    0x34
     * ã€€ã€€ã€€ã€€ã€€ã€€         0x56
     *       å†…å­˜é«˜åœ°å€--> 0x78
     *
     *       å°ç«¯å­—èŠ‚åºï¼š
     *       å†…å­˜ä½åœ°å€--> 0x78
     * ã€€ã€€ã€€ã€€ã€€ã€€ã€€       0x56
     * ã€€ã€€ã€€ã€€ã€€ã€€ã€€       0x34
     *       å†…å­˜é«˜åœ°å€--> 0x12
     *  </pre>
     */
    @Test
    public void testBigEndianAndLittleEndian () {
        ByteBuffer buffer = ByteBuffer.allocate(4);
        buffer.order(ByteOrder.BIG_ENDIAN);
        buffer.asIntBuffer().put(1);
        System.out.println(Arrays.toString(buffer.array()));

        // å°ç«¯åº
        ByteBuffer buffer2 = ByteBuffer.allocate(4);
        buffer2.order(ByteOrder.LITTLE_ENDIAN);
        buffer2.asIntBuffer().put(1);
        System.out.println(Arrays.toString(buffer2.array()));
    }

    /**
     * 5.Javaä¸­å†…ç å’Œå¤–ç çš„åŒºåˆ†
     *   å†…ç ï¼šcharæˆ–Stringåœ¨å†…å­˜é‡Œä½¿ç”¨çš„ç¼–ç æ–¹å¼ï¼Œå†…ç ä½¿ç”¨çš„æ˜¯UTF-16.
     *
     *   å½“è¿è¡Œjavaå­—èŠ‚ç æ—¶ï¼Œè¯»å…¥åˆ°å†…å­˜é‡Œçš„å­—ç¬¦æˆ–è€…å­—ç¬¦ä¸²éƒ½ç”¨charæˆ–char[]è¡¨ç¤ºï¼Œè€Œcharæ˜¯é‡‡ç”¨utf-16çš„ä½†ä¸æ˜¯çœŸæ­£çš„utf-16ï¼Œ
     *   ä¸ºä»€ä¹ˆè¿™æ ·è¯´? charåœ¨javaé‡Œä¸€ç›´æ˜¯16ä½çš„ä¹Ÿå°±æ˜¯è¯´åªèƒ½è¡¨ç¤ºå¸¦utf-16çš„0x0000-0xFFFFä¸ºæ­¢ï¼Œå½“å¯¹äºè¶…è¿‡16ä½çš„utf-16å­—ç¬¦
     *   æ¥è¯´(æ¯”å¦‚è¡¨æƒ…ç¬¦å·)å°±éœ€è¦å¤šä¸ªcharã€‚
     *
     *   è¡¥å……ï¼š
     *     UTF-16ç¼–ç ä¸€ä¸ªå­—ç¬¦å¯¹äºU+0000-U+FFFFèŒƒå›´å†…çš„å­—ç¬¦é‡‡ç”¨2å­—èŠ‚è¿›è¡Œç¼–ç ï¼Œè€Œå¯¹äºå­—ç¬¦çš„ç ç‚¹å¤§äºU+FFFFçš„å­—ç¬¦é‡‡ç”¨å››å­—èŠ‚è¿›è¡Œç¼–ç ã€‚
     *
     *   å¤–ç ï¼šé™¤äº†å†…ç éƒ½å¯ä»¥è®¤ä¸ºæ˜¯â€œå¤–ç â€ã€‚ï¼ˆåŒ…æ‹¬classæ–‡ä»¶çš„ç¼–ç ï¼‰
     *
     *   javaæºæ–‡ä»¶ .java å’Œç¼–è¯‘åçš„ .class æ–‡ä»¶ï¼Œæºæ–‡ä»¶å¯ä»¥é‡‡ç”¨å¤šç§ç¼–ç æ ¼å¼å¦‚UTF-8æˆ–GBKã€‚é»˜è®¤æ˜¯javac æŒ‰ç…§ç³»ç»Ÿé»˜è®¤çš„ç¼–ç 
     *   æ ¼å¼è¯»å–javaæºæ–‡ä»¶ï¼Œç„¶åä»¥utf-8çš„æ ¼å¼è¾“å‡ºåˆ° .class æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹unixå¹³å°ï¼Œjavacç”¨utf-8æ ¼å¼è¯»å–
     *   javaæºæ–‡ä»¶ç„¶åä»¥utf-8æ ¼å¼å†™.classï¼›åœ¨é»˜è®¤æƒ…å†µä¸‹windowså¹³å°ï¼Œjavacç”¨gbkæ ¼å¼è¯»å–javaæºæ–‡ä»¶ç„¶åä»¥utf-8æ ¼å¼å†™.classã€‚
     *
     *
     *  æ­£é¢˜ï¼šString.length()è¿”å›å­—ç¬¦ä¸²ä¸­çš„ Unicode ä»£ç å•å…ƒçš„æ•°ç›®
     *
     *  1ï¼‰ä»£ç å•å…ƒæŒ‡ä¸€ç§è½¬æ¢æ ¼å¼ï¼ˆUTFï¼‰ä¸­æœ€å°çš„ä¸€ä¸ªåˆ†éš”ï¼Œç§°ä¸ºä¸€ä¸ªä»£ç å•å…ƒï¼ˆCode Unitï¼‰ã€‚å› æ­¤ï¼Œä¸€ç§è½¬æ¢æ ¼å¼åªä¼šåŒ…å«æ•´æ•°ä¸ª
     *     å•å…ƒã€‚UTF-X ä¸­çš„æ•°å­— X å°±æ˜¯å„è‡ªä»£ç å•å…ƒçš„ä½æ•°ã€‚
     *  2ï¼‰UTF-16çš„16æŒ‡çš„å°±æ˜¯æœ€å°ä¸º16ä½ä¸€ä¸ªå•å…ƒï¼Œä¹Ÿå³ä¸¤å­—èŠ‚ä¸ºä¸€ä¸ªå•å…ƒï¼ŒUTF-16å¯ä»¥åŒ…å«ä¸€ä¸ªå•å…ƒå’Œä¸¤ä¸ªå•å…ƒï¼Œå¯¹åº”å³æ˜¯ä¸¤ä¸ªå­—èŠ‚
     *     å’Œå››ä¸ªå­—èŠ‚ã€‚
     */
    @Test
    public void testStringLength () {
        String str = "hello world";
        System.out.println(str.length());

        // å››ä¸ªå­—èŠ‚emojiè¡¨æƒ…ï¼Œé•¿åº¦ä¸ºä¸¤ä¸ªå•å…ƒ
        String emoji = "ğŸ˜‚";
        System.out.println(emoji.length());
    }

    /**
     * è¡¨æƒ…å­—ç¬¦è½¬ç¼–ç 
     */
    @Test
    public void testEmojiEncode () throws UnsupportedEncodingException {
        String emoji = "ğŸ˜‚";
        byte[] bytes = emoji.getBytes("UTF-32");
        System.out.println(Arrays.toString(bytes));
        System.out.println(getBytesCode(bytes));
    }

    private static String getBytesCode(byte[] bytes) {
        StringBuilder code = new StringBuilder();
        for (byte b : bytes) {
            code.append("\\0x").append(Integer.toHexString(b & 0xff));
        }
        return code.toString();
    }

    /**
     * ç¼–ç è½¬emojiè¡¨æƒ…
     */
    @Test
    public void testEmojiDecode () throws UnsupportedEncodingException {
        // 16è¿›åˆ¶è½¬10è¿›åˆ¶
        int emojiCode = Integer.valueOf("1f602", 16);
        byte[] emojiBytes = int2bytes(emojiCode);
        String emojiChar = new String(emojiBytes, "UTF-32");
        System.out.println(emojiChar);
    }

    private static byte[] int2bytes(int num){
        byte[] result = new byte[4];
        result[0] = (byte)((num >>> 24) & 0xff);
        result[1] = (byte)((num >>> 16) & 0xff );
        result[2] = (byte)((num >>> 8) & 0xff );
        result[3] = (byte)((num) & 0xff );
        return result;
    }
}
